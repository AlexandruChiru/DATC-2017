@model IEnumerable<KappaWebApp.Models.SensorData>
@{
    ViewBag.Title = "Home Page";
    Layout = null;
}

<html>
<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="~/Content/CssFiles/IndexCSS.css"/>
    @*<script type="text/javascript" src="~/Scripts/JavaScriptFiles/GoogleAPI.js"></script>*@

    <script>
        function initMap() {
            var jItem = @Html.Raw(Json.Encode(Model));
            var parcBotanic = new google.maps.LatLng(45.76046, 21.225);
            //var heatmap = new google.maps.visualization.HeatmapLayer({
            //    data: heatmapData
            //});


            //var heatmapData = [
            //    { location: new google.maps.LatLng(45.76046, 21.225), weight: 10 },
            //    new google.maps.LatLng(45.76046, 21.225),
            //    { location: new google.maps.LatLng(45.76046, 21.2251), weight: 25 },
            //    { location: new google.maps.LatLng(45.76046, 21.226), weight: 100 },
            //    { location: new google.maps.LatLng(45.76046, 21.224), weight: 150 }
            //];

            

            //map = new google.maps.Map(document.getElementById('map'), {
            //    center: parcBotanic,
            //    zoom: 16,
            //});

            //   heatmap.setMap(map);
            
            var options = {
                zoom: 18,
                center: parcBotanic
            }

            // New map
            var map = new google.maps.Map(document.getElementById('map'), options);

            // Adaugare marker pe click-btn
            //google.maps.event.addListener(map, 'click', function (event) {
            //    // Add marker
            //    addMarker({ coords: event.latLng });
            //});


            for (var i = 0; i < jItem.length; i++) {
                // Add marker
                addMarker(jItem[i]);
            }
            // Add Marker Function
            function addMarker(props) {
                var marker = new google.maps.Marker({
                    position: { lat: parseFloat(props.Lat), lng: parseFloat(props.Lng) },
                    map: map,
                    //icon:props.iconImage
                });

                var newContent = document.createElement('div');
                var div = document.createElement('div');
                div.innerText = "Temperature: " + props.Temperature.toString() + " Humidity: " + props.Humidity.toString();
                newContent.appendChild(div);

                //// Check for customicon
                //if (props.iconImage) {
                //    // Set icon image
                //    marker.setIcon(props.iconImage);
                //}

                //if (props.Temperature) {
                //    var infoWindow = new google.maps.InfoWindow({
                //        content: "'<h1>"+ "Temp:" + props.Temperature + "  Hum: " + props.Humidity +"</h1>'"
                //    });

                var infoWindow = new google.maps.InfoWindow({
                    content: newContent
                });
                marker.addListener('click', function () {
                    infoWindow.open(map, marker);
                });
            }
        }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCeBrzsotmd8hGyxSeaFXiiOM_kfL2nnm4&callback=initMap&libraries=visualization" async defer></script>
</head>
<body>
    <div>
        <h1 style="align-content:center">Vizualizare hartă</h1>
    </div>
    <div id="map"></div>
</body>
</html>